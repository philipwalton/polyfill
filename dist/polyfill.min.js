/*!
 * Polyfill.js - v0.1.0
 *
 * Copyright (c) 2013 Philip Walton <http://philipwalton.com>
 * Released under the MIT license
 *
 * Date: 2013-11-21
 */
!function(a,b){"use strict";function c(a){return a.replace(/^\s+|\s+$/g,"")}function d(a,b){var c,d=0;if(!a||!b)return!1;for(;c=b[d++];)if(a===c)return!0;return!1}function e(a){return i.test(a)}function f(a){var b,c=0;for(this._rules=[];b=a[c++];)this._rules.push(new g(b))}function g(a){this._rule=a}function h(a){return this instanceof h?(this._options=a,a.keywords||(this._options={keywords:a}),this._promise=[],this._getStylesheets(),this._downloadStylesheets(),this._parseStylesheets(),this._filterCSSByKeywords(),this._buildMediaQueryMap(),this._reportInitialMatches(),this._addMediaListeners(),void 0):new h(a)}var i=RegExp("^"+String({}.valueOf).replace(/[.*+?\^${}()|\[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),j=function(){var a=b.getElementsByTagName("base")[0],c=/^([a-zA-Z:]*\/\/)/;return function(b){var d=!c.test(b)&&!a||b.replace(RegExp.$1,"").split("/")[0]===location.host;return d}}(),k={matchMedia:a.matchMedia&&a.matchMedia("only all").matches,nativeMatchMedia:e(a.matchMedia)},l=function(){function b(a){for(var b,c=0;b=a[c++];)i[b]||d(b,j)||j.push(b)}function c(){if(0===m.readyState||4===m.readyState){var a;(a=j[0])&&e(a),a||g()}}function e(a){l++,m.open("GET",a,!0),m.onreadystatechange=function(){4!=m.readyState||200!=m.status&&304!=m.status||(i[a]=m.responseText,j.shift(),c())},m.send(null)}function f(a){for(var b,c=0,d=0;b=a[c++];)i[b]&&d++;return d===a.length}function g(){for(var a;a=k.shift();)h(a.urls,a.fn)}function h(a,b){for(var c,d=[],e=0;c=a[e++];)d.push(i[c]);b.call(null,d)}var i={},j=[],k=[],l=0,m=function(){var b;try{b=new a.XMLHttpRequest}catch(c){b=new a.ActiveXObject("Microsoft.XMLHTTP")}return b}();return{request:function(a,d){k.push({urls:a,fn:d}),f(a)?g():(b(a),c())},clearCache:function(){i={}},_getRequestCount:function(){return l}}}(),m={_cache:{},clearCache:function(){m._cache={}},parse:function(a,b){function d(){return g(/^\{\s*/)}function e(){return g(/^\}\s*/)}function f(){var b,c=[];for(h(),i(c);"}"!=a.charAt(0)&&(b=y()||z());)c.push(b),i(c);return c}function g(b){var c=b.exec(a);if(c)return a=a.slice(c[0].length),c}function h(){g(/^\s*/)}function i(a){a=a||[];for(var b;b=j();)a.push(b);return a}function j(){if("/"==a[0]&&"*"==a[1]){for(var b=2;"*"!=a[b]||"/"!=a[b+1];)++b;b+=2;var c=a.slice(2,b-2);return a=a.slice(b),h(),{comment:c}}}function k(){var a=g(/^([^{]+)/);if(a)return c(a[0]).split(/\s*,\s*/)}function l(){var a=g(/^(\*?[\-\w]+)\s*/);if(a&&(a=a[0],g(/^:\s*/))){var b=g(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)\s*/);if(b)return b=c(b[0]),g(/^[;\s]*/),{property:a,value:b}}}function n(){for(var a,b=[];a=g(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/);)b.push(a[1]),g(/^,\s*/);return b.length?{values:b,declarations:x()}:void 0}function o(){var a=g(/^@([\-\w]+)?keyframes */);if(a){var b=a[1],a=g(/^([\-\w]+)\s*/);if(a){var c=a[1];if(d()){i();for(var f,h=[];f=n();)h.push(f),i();if(e()){var j={name:c,keyframes:h};return b&&(j.vendor=b),j}}}}}function p(){var a=g(/^@supports *([^{]+)/);if(a){var b=c(a[1]);if(d()){i();var h=f();if(e())return{supports:b,rules:h}}}}function q(){var a=g(/^@media *([^{]+)/);if(a){var b=c(a[1]);if(d()){i();var h=f();if(e())return{media:b,rules:h}}}}function r(){var a=g(/^@page */);if(a){var b=k()||[],c=[];if(d()){i();for(var f;f=l()||s();)c.push(f),i();if(e())return{type:"page",selectors:b,declarations:c}}}}function s(){var a=g(/^@([a-z\-]+) */);if(a){var b=a[1];return{type:b,declarations:x()}}}function t(){return w("import")}function u(){return w("charset")}function v(){return w("namespace")}function w(a){var b=g(new RegExp("^@"+a+" *([^;\\n]+);\\s*"));if(b){var d={};return d[a]=c(b[1]),d}}function x(){var a=[];if(d()){i();for(var b;b=l();)a.push(b),i();if(e())return a}}function y(){return o()||q()||p()||t()||u()||v()||r()}function z(){var a=k();if(a)return i(),{selectors:a,declarations:x()}}return b&&m._cache[b]?m._cache[b]:(a=a.replace(/\/\*[\s\S]*?\*\//g,""),m._cache[b]=f())},filter:function(a,b){function d(a,b){return a||b?a?a.concat(b):[b]:void 0}function e(a){null==a.media&&delete a.media,null==a.supports&&delete a.supports,k.push(a)}function f(a,b){if(b)for(var c=b.length;c--;)if(a.indexOf(b[c])>=0)return!0}function g(a,b){for(var d,e,f,g,h=/\*/,i=0;d=b[i++];)if(e=d.split(":"),f=new RegExp("^"+c(e[0]).replace(h,".*")+"$"),g=new RegExp("^"+c(e[1]).replace(h,".*")+"$"),f.test(a.property)&&g.test(a.value))return!0}function h(a,c,d){return b.selectors?f(a.selectors.join(","),b.selectors)?(e({media:c,supports:d,selectors:a.selectors,declarations:a.declarations}),!0):void 0:void 0}function i(a,c,d){if(b.declarations)for(var f,h=0;f=a.declarations[h++];)if(g(f,b.declarations))return e({media:c,supports:d,selectors:a.selectors,declarations:a.declarations}),!0}function j(a,b,c){for(var e,f=0;e=a[f++];)e.declarations?h(e,b,c)||i(e,b,c):e.rules&&e.media?j(e.rules,d(b,e.media),c):e.rules&&e.supports&&j(e.rules,b,d(c,e.supports))}var k=[];return j(a),k}},n=function(){function c(){if(f)return f;var a=b.documentElement,c=b.body,d=a.style.fontSize,e=c.style.fontSize,g=b.createElement("div");return a.style.fontSize="1em",c.style.fontSize="1em",c.appendChild(g),g.style.width="1em",g.style.position="absolute",f=g.offsetWidth,c.removeChild(g),c.style.fontSize=e,a.style.fontSize=d,f}function d(b){return a.matchMedia(b)}function e(a){var d,e,f=!1;return g=b.documentElement.clientWidth,h.test(a)&&(d="em"===RegExp.$2?parseFloat(RegExp.$1)*c():parseFloat(RegExp.$1)),i.test(a)&&(e="em"===RegExp.$2?parseFloat(RegExp.$1)*c():parseFloat(RegExp.$1)),d&&e?f=g>=d&&e>=g:(d&&g>=d&&(f=!0),e&&e>=g&&(f=!0)),{matches:f,media:a}}var f,g,h=/\(min\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/,i=/\(max\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/,j={};return{matchMedia:function(a){return k.matchMedia?d(a):e(a)},clearCache:function(){k.nativeMatchMedia||(g=null,j={})}}}(),o=function(){function b(a,b){var c;return function(){clearTimeout(c),c=setTimeout(a,b)}}var c=function(){var a=[];return{add:function(b,c,d){for(var e,f=0;e=a[f++];)if(e.polyfill==b&&e.mql===c&&e.fn===d)return!1;c.addListener(d),a.push({polyfill:b,mql:c,fn:d})},remove:function(b){for(var c,d=0;c=a[d++];)c.polyfill===b&&(c.mql.removeListener(c.fn),a.splice(--d,1))}}}(),d=function(b){function c(){for(var a,c=0;a=b[c++];)a.fn()}return{add:function(d,e){b.length||(a.addEventListener?a.addEventListener("resize",c,!1):a.attachEvent("onresize",c)),b.push({polyfill:d,fn:e})},remove:function(d){for(var e,f=0;e=b[f++];)e.polyfill===d&&b.splice(--f,1);b.length||(a.removeEventListener?a.removeEventListener("resize",c,!1):a.detachEvent&&a.detachEvent("onresize",c))}}}([]);return{removeListeners:function(a){k.nativeMatchMedia?c.remove(a):d.remove(a)},addListeners:function(a,e){function f(){if(k.nativeMatchMedia)for(var f in h)h.hasOwnProperty(f)&&!function(b,d){c.add(a,b,function(){e.call(a,d,b.matches)})}(h[f],f);else{var i=b(function(a,b){return function(){g(a,b)}}(a,h),a._options.debounceTimeout||100);d.add(a,i)}}function g(a,b){var c,d={};n.clearCache();for(c in b)b.hasOwnProperty(c)&&(d[c]=n.matchMedia(c).matches,d[c]!=i[c]&&e.call(a,c,n.matchMedia(c).matches));i=d}var h=a._mediaQueryMap,i={};!function(){for(var a in h)h.hasOwnProperty(a)&&(i[a]=n.matchMedia(a).matches)}(),f()}}}();f.prototype.each=function(a,b){var c,d=0;for(b||(b=this);c=this._rules[d++];)a.call(b,c)},f.prototype.size=function(){return this._rules.length},f.prototype.at=function(a){return this._rules[a]},g.prototype.getDeclaration=function(){for(var a,b={},c=0,d=this._rule.declarations;a=d[c++];)b[a.property]=a.value;return b},g.prototype.getSelectors=function(){return this._rule.selectors.join(", ")},g.prototype.getMedia=function(){return this._rule.media.join(" and ")},h.prototype.doMatched=function(a){return this._doMatched=a,this._resolve(),this},h.prototype.undoUnmatched=function(a){return this._undoUnmatched=a,this._resolve(),this},h.prototype.getCurrentMatches=function(){for(var a,b,c=0,d=[];a=this._filteredRules[c++];)b=a.media&&a.media.join(" and "),(!b||n.matchMedia(b).matches)&&d.push(a);return new f(d)},h.prototype.destroy=function(){this._undoUnmatched&&(this._undoUnmatched(this.getCurrentMatches()),o.removeListeners(this))},h.prototype._defer=function(a,b){a.call(this)?b.call(this):this._promise.push({condition:a,callback:b})},h.prototype._resolve=function(){for(var a,b=0;a=this._promise[b];)a.condition.call(this)?(this._promise.splice(b,1),a.callback.call(this)):b++},h.prototype._getStylesheets=function(){var a,c,e,f,g,h=0,i=[];if(this._options.include){for(c=this._options.include;a=c[h++];)if(e=b.getElementById(a)){if(e.media&&"print"==e.media)continue;if(!j(e.href))continue;g={href:e.href},e.media&&(g.media=e.media),i.push(g)}}else for(c=this._options.exclude,f=b.getElementsByTagName("link");e=f[h++];)e.rel&&"stylesheet"==e.rel&&"print"!=e.media&&j(e.href)&&!d(e.id,c)&&(g={href:e.href},e.media&&(g.media=e.media),i.push(g));return this._stylesheets=i},h.prototype._downloadStylesheets=function(){for(var a,b=this,c=this._options.stylesheetContents,d=[],e=0;a=this._stylesheets[e++];)c&&c[a.href]?a.text=c[a.href]:d.push(a.href);d.length||this._resolve(),l.request(d,function(a){for(var c,d=0;c=a[d];)b._stylesheets[d++].text=c;b._resolve()})},h.prototype._parseStylesheets=function(){this._defer(function(){return this._stylesheets&&this._stylesheets.length&&this._stylesheets[0].text},function(){for(var a,b=0;a=this._stylesheets[b++];)a.rules=m.parse(a.text,a.url)})},h.prototype._filterCSSByKeywords=function(){this._defer(function(){return this._stylesheets&&this._stylesheets.length&&this._stylesheets[0].rules},function(){for(var a,b,c=[],d=0;a=this._stylesheets[d++];)b=a.media,b&&"all"!=b&&"screen"!=b?c.push({rules:a.rules,media:a.media}):c=c.concat(a.rules);this._filteredRules=m.filter(c,this._options.keywords)})},h.prototype._buildMediaQueryMap=function(){this._defer(function(){return this._filteredRules},function(){var a,b,c=0;for(this._mediaQueryMap={};b=this._filteredRules[c++];)b.media&&(a=b.media.join(" and "),this._mediaQueryMap[a]=n.matchMedia(a))})},h.prototype._reportInitialMatches=function(){this._defer(function(){return this._filteredRules&&this._doMatched},function(){this._doMatched(this.getCurrentMatches())})},h.prototype._addMediaListeners=function(){this._defer(function(){return this._filteredRules&&this._doMatched&&this._undoUnmatched},function(){o.addListeners(this,function(a,b){for(var c,d=0,e=[],g=[];c=this._filteredRules[d++];)c.media&&c.media.join(" and ")==a&&(b?e:g).push(c);e.length&&this._doMatched(new f(e)),g.length&&this._undoUnmatched(new f(g))})})},h.modules={DownloadManager:l,StyleManager:m,MediaManager:n,EventManager:o},h.constructors={Ruleset:f,Rule:g},a.Polyfill=h}(window,document);